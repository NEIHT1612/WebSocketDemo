<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chat application</title>
</head>
<body>
<div class="container">
    <div class="chat">
        <div class="santaSays">
            <div class="text-box-santa">
                <div class="text">
                    <p>Hi there, my child!</p>
                    <p>What can I help you with?</p>
                </div>
            </div>
        </div>
        <div class="userSays">
            <div class="text">
                <p>Hello, Santa!</p>
                <p>I'd like to know when you'll bring my gift?</p>
            </div>
        </div>
    </div>
    <hr>
    <div class="message-box">
        <div class="message-input">
            <input id="inputText" type="text" placeholder="What can I help you with?">
        </div>
        <div class="send-btn">
            <i class="fa-solid fa-paper-plane plane"></i>
        </div>
    </div>
</div>
</body>
</html>

<script>
    const chat = document.querySelector(".chat");
    const inputText = document.getElementById("inputText");
    let ws;

    // check if browser supports WebSocket
    if (window.WebSocket === undefined) {
        console.log("Your browser does not support WebSockets")
    } else {
        ws = initWS();
    }

    function initWS() {
        let socket = new WebSocket("ws://" + window.location.host + "/ws" + window.location.search)

        socket.onopen = function() {
            console.log("Socket is open")
        };

        // receive data from server
        socket.onmessage = function (e) {
        const msg = JSON.parse(e.data).message;

        let msgWrapper = document.createElement("div");
        msgWrapper.classList.add("message", "santaMessage");

        let pS = document.createElement("p");
        pS.innerHTML = msg;

        msgWrapper.appendChild(pS);
        chat.appendChild(msgWrapper);
        chat.scrollTop = chat.scrollHeight;
        }


        // close socket
        socket.onclose = function () {
            console.log("Socket closed")
        }

        return socket;
    }

    //read input text and send to server
    inputText.addEventListener("keyup", (e) => {
    if (e.key === "Enter" && inputText.value.trim() !== "") {
        let msgWrapper = document.createElement("div");
        msgWrapper.classList.add("message", "userMessage");

        let pU = document.createElement("p");
        pU.innerHTML = inputText.value;

        msgWrapper.appendChild(pU);
        chat.appendChild(msgWrapper);
        chat.scrollTop = chat.scrollHeight;

        ws.send(JSON.stringify({message: inputText.value}));
        inputText.value = "";
    }});

</script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/Z1srPv7lOy7C2vNTSRyMA2Fd33n5dQ8lXKgvxWlJo++R+T+eDzpD/0P9nddOYZiH3AQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
  rel="stylesheet"
  integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
  crossorigin="anonymous"
/>
<link rel="stylesheet" href="/static/chat.css">
